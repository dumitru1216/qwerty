#include "exploits.h"
#include "../../c_hooks.h"
#include "../external_inclues.h"

c_exploits exploit;

void c_exploits::air_stuck()
{
	if (galaxy_vars.cfg.air_stuck)
	{
		if (GetAsyncKeyState( galaxy_vars.cfg.air_key ))
		{
			g::pCmd->command_number = INT_MAX;
			g::pCmd->tick_count = INT_MAX;
		}
	}

}

void c_exploits::air_desync( )
{
	if (galaxy_vars.cfg.air_desync && !((g::pCmd->buttons & IN_DUCK)) && g::pLocalEntity != nullptr)
	{
		if (!(g::pCmd->buttons & IN_JUMP) || (g::pLocalEntity->get_flags( ) & fl_onground ) || g::pLocalEntity->get_velocity( ).z >= -140.0)
			g::pCmd->buttons &= ~IN_DUCK;
		else
			g::pCmd->buttons |= IN_DUCK;
	}
}

void c_exploits::create_move( )
{
	if (!csgo_engine->in_game( )) return; 
	if (!g::pLocalEntity->IsAlive( )) return;

	air_stuck( );
	air_desync( );
}